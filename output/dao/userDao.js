var mysql=require("mysql"),$conf=require("../conf/db"),$util=require("../util/util"),$sql=require("./userSqlMapping"),pool=mysql.createPool($util.extend({},$conf.mysql)),jsonWrite=function(e,n){e.json("undefined"==typeof n?{code:"1",msg:"操作失败"}:n)};module.exports={add:function(e,n){pool.getConnection(function(o,t){var r=e.query||e.params;t.query($sql.insert,[r.name,r.age],function(e,o){o&&(o={code:200,msg:"增加成功"}),jsonWrite(n,o),t.release()})})},"delete":function(e,n){pool.getConnection(function(o,t){var r=+e.query.id;t.query($sql.delete,r,function(e,o){o=o.affectedRows>0?{code:200,msg:"删除成功"}:void 0,jsonWrite(n,o),t.release()})})},update:function(e,n){var o=e.body;return null==o.name||null==o.age||null==o.id?void jsonWrite(n,void 0):void pool.getConnection(function(e,t){t.query($sql.update,[o.name,o.age,+o.id],function(e,o){o.affectedRows>0?n.render("suc",{result:o}):n.render("fail",{result:o}),console.log(o),t.release()})})},queryById:function(e,n){var o=+e.query.id;pool.getConnection(function(e,t){t.query($sql.queryById,o,function(e,o){jsonWrite(n,o),t.release()})})},queryAll:function(e,n){pool.getConnection(function(e,o){o.query($sql.queryAll,function(e,t){jsonWrite(n,t),o.release()})})}};